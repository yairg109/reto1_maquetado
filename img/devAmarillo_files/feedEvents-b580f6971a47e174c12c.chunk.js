(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{439:function(e,t,n){"use strict";n.r(t),n.d(t,"observeFeedElements",(function(){return i}));var o={queue:[],processInterval:null,observer:new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&e.intersectionRatio>=.25&&queueMicrotask((function(){var t=e.target;t.dataset.impressionRecorded||(a(t,o.categoryImpression),t.dataset.impressionRecorded=!0)}))}))}),{root:null,rootMargin:"0px",threshold:.25}),beaconEnabled:!0,nextFeedPosition:null};function i(){var e=document.getElementById("index-container"),t=document.getElementById("rendered-article-feed");if(e&&t){var n=e.dataset,i=n.feedCategoryClick,s=n.feedCategoryImpression,a=n.feedContextType;o.categoryClick=i,o.categoryImpression=s,o.contextType=a,o.processInterval||(o.processInterval=setInterval(d,5e3)),o.observer.disconnect(),o.nextFeedPosition=1,r(t),document.addEventListener("visibilitychange",(function(){"hidden"==document.visibilityState&&d()})),window.addEventListener("beforeunload",d)}}function r(e){Array.from(e.children).forEach((function(e){var t;e.classList.contains("paged-stories")?r(e):null!==(t=e.dataset)&&void 0!==t&&t.feedContentId&&(e.dataset.feedPosition=o.nextFeedPosition,e.addEventListener("mousedown",s,!0),o.observer.observe(e),o.nextFeedPosition+=1)}))}function s(e){var t=e.currentTarget;t.dataset.clickRecorded||(a(t,o.categoryClick),t.dataset.clickRecorded=!0,d())}function a(e,t){var n=e.dataset,i=n.feedContentId,r=n.feedPosition;o.queue.push({article_id:i,article_position:r,category:t,context_type:o.contextType}),o.queue.length>=20&&d()}function d(){if(0!==o.queue.length){var e=document.querySelector("meta[name='csrf-token']"),t=null===e||void 0===e?void 0:e.getAttribute("content");if(o.beaconEnabled){var n=new Blob([JSON.stringify({authenticity_token:t,feed_events:o.queue})],{type:"application/json"});o.beaconEnabled=navigator.sendBeacon("/feed_events",n)}else!function(e){window.fetch("/feed_events",{method:"POST",headers:{"X-CSRF-Token":e,"Content-Type":"application/json"},body:JSON.stringify({feed_events:o.queue}),credentials:"same-origin",keepalive:!0}).catch((function(e){return console.error(e)}))}(t);o.queue=[]}}window.observeFeedElements=i}},[[439,132]]]);
//# sourceMappingURL=feedEvents-b580f6971a47e174c12c.chunk.js.map